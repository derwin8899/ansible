- hosts: all
  tasks:
  - name: Ansible copy users.allow for backup
    copy:
      src: /app1/users.allow
      dest: /app1/users.allow.backup
      remote_src: yes

  - name: Ansible copy sudoers file for backup
    copy:
      src: /etc/sudoers
      dest: /etc/sudoers.backup
      remote_src: yes

  - name: Append users.allow with svc_1900
    lineinfile:
      path: /app1/users.allow
      line: svc_1900

  - name: Update /etc/sudoers file with commands for svc_1900
    blockinfile:
      path: /etc/sudoers
      insertbefore: "## Allows members of the 'sys' group to run networking, software,"
      block: |
        svc_1900        ALL=(ALL)       NOPASSWD: /usr/sbin/lsof
        svc_1900        ALL=(ALL)       NOPASSWD: /bin/ethtool
        svc_1900        ALL=(ALL)       NOPASSWD: /usr/bin/netstat
        svc_1900        ALL=(ALL)       NOPASSWD: /usr/sbin/dmidecode
      validate: 'visudo -cf %s'